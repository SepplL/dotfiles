- name: Bootstrap development environment
  hosts: localhost

  tasks:
    - name: Install packages with dnf
      become: yes
      ansible.builtin.dnf:
        name:
        - git
        - make
        - curl
        - zsh
        - zig
        - neovim
        - fzf
        - eza
        - zoxide
        - stow
        - waybar
        - river
        - swaylock
        - swaybg
        - swaybar
        - ghostty
        - rofi
        state: present
      when: ansible_distribution == "Fedora"

    - name: Install packages with zypper
      become: yes
      community.general.zypper:
        name:
        - git
        - make
        - curl
        - zsh
        - zig
        - neovim
        - fzf
        - eza
        - zoxide
        - stow
        - waybar
        - wlogout
        - river
        - swaylock
        - swaybg
        - swaybar
        - ghostty
        - rofi
        - niri
        - grim
        - slurp
        - xwayland-devel
        - xwayland-run
        - libxcb-errors0
        state: present
      when: ansible_distribution == "openSUSE Tumbleweed"

    - stat:
        path: $HOME/.local/bin/brightnessChanger
      register: statusBR

    - stat:
        path: $HOME/.local/share/fonts/JetBrainsMonoNLNerdFontMono-Medium.ttf
      register: JetBrainsNerdFont

    - stat:
        path: /usr/local/bin/riveroverflow
      register: riveroverflow

    - name: Install JetBrains Mono Nerd Font
      shell: |
        mkdir -p ~/.local/share/fonts && cd ~/.local/share/fonts
        curl -OL https://github.com/ryanoasis/nerd-fonts/releases/latest/download/JetBrainsMono.tar.xz
        tar xvf JetBrainsMono.tar.xz
        cd -
      when: not JetBrainsNerdFont.stat.exists

    - name: Include building Brightness Changer from custom to ~/.local
      # shell: "cd custom/brightnessChanger"
      include_tasks: ./custom/brightnessChanger/build.yml
      # shell: "cd -"
      when: not statusBR.stat.exists

    - name: Build and install riveroverflow
      shell: |
        cd custom/riveroverflow
        make
        sudo make install
        cd -
      when: not riveroverflow.stat.exists

    - name: Run Stow  # to manage the dotfiles
      shell: "stow --target={{ ansible_env.HOME }} .dotfiles --verbose=2"
      register: result
      changed_when: 'result.stderr is search("LINK: ")'
