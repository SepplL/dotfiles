- name: Bootstrap development environment
  hosts: localhost

  tasks:
    - name: Install packages with dnf
      become: yes
      ansible.builtin.dnf:
        name:
        - git
        - make
        - curl
        - zsh
        - zig
        - neovim
        - fzf
        - eza
        - zoxide
        - stow
        - waybar
        - river
        - swaylock
        - swaybg
        - swaybar
        - ghostty
        - rofi
        state: present
      when: ansible_distribution == "Fedora"

    - name: Install packages with zypper
      become: yes
      community.general.zypper:
        name:
        - git
        - make
        - curl
        - zsh
        - zig
        - neovim
        - fzf
        - eza
        - zoxide
        - stow
        - waybar
        - river
        - swaylock
        - swaybg
        - swaybar
        - ghostty
        - rofi
        state: present
      when: ansible_distribution == "openSUSE Tumbleweed"

    - stat: 
        path: $HOME/.local/bin/brightnessChanger
      register: statusBR

    - name: Include building Brightness Changer from custom to ~/.local
      include_tasks: ./custom/brightnessChanger/build.yml
      when: not statusBR.stat.exists

    - name: Run Stow  # to manage the dotfiles
      shell: "stow --target={{ ansible_env.HOME }} .dotfiles --verbose=2"
      register: result
      changed_when: 'result.stderr is search("LINK: ")'
